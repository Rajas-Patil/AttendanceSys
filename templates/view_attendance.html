<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Attendance Analytics</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <!-- Include Chart.js for visualizations -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Include Date Range Picker -->
    <script type="text/javascript" src="https://cdn.jsdelivr.net/jquery/latest/jquery.min.js"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/momentjs/latest/moment.min.js"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.min.js"></script>
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.css" />
    <!-- Include DataTables -->
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.4/css/jquery.dataTables.min.css">
    <script src="https://cdn.datatables.net/1.13.4/js/jquery.dataTables.min.js"></script>
    <!-- Include Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <!-- Include SweetAlert2 for notifications -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f5f7fa;
            padding: 0;
            margin: 0;
            color: #333;
        }
        
        .navbar {
            background: linear-gradient(90deg, #2196F3, #1976D2, #0D47A1);
            padding: 15px 20px;
            color: white;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
        
        .navbar h1 {
            margin: 0;
            font-size: 1.6rem;
            text-align: center;
            text-shadow: 1px 1px 3px rgba(0,0,0,0.3);
        }
        
        .container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 20px;
        }
        
        .card {
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 6px 18px rgba(0,0,0,0.1);
            padding: 20px;
            margin-bottom: 25px;
            transition: transform 0.3s, box-shadow 0.3s;
        }
        
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.15);
        }
        
        .card-header {
            border-bottom: 1px solid rgba(0,0,0,0.05);
            padding-bottom: 18px;
            margin-bottom: 25px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        h2 {
            color: #1976D2;
            margin: 0;
            font-size: 1.4rem;
            font-weight: 600;
        }
        
        .dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: linear-gradient(135deg, #2196F3, #1565C0);
            color: white;
            border-radius: 15px;
            padding: 25px;
            text-align: center;
            box-shadow: 0 8px 16px rgba(0,0,0,0.15);
            position: relative;
            overflow: hidden;
            z-index: 1;
        }
        
        .stat-card::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0) 70%);
            z-index: -1;
        }
        
        .stat-card h3 {
            margin: 0;
            font-size: 0.95rem;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 1.5px;
            opacity: 0.85;
        }
        
        .stat-card p {
            font-size: 2.2rem;
            font-weight: bold;
            margin: 15px 0 5px;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
        }
        
        .chart-container {
            height: 350px;
            margin-bottom: 35px;
            padding: 10px;
        }
        
        .table-container {
            overflow-x: auto;
            border-radius: 8px;
            box-shadow: 0 0 15px rgba(0,0,0,0.05);
        }
        
        /* DataTables custom styling */
        .dataTables_wrapper .dataTables_length, 
        .dataTables_wrapper .dataTables_filter {
            margin-bottom: 15px;
        }
        
        .dataTables_wrapper .dataTables_length select {
            padding: 5px 10px;
            border-radius: 5px;
            border: 1px solid #ddd;
        }
        
        .dataTables_wrapper .dataTables_filter input {
            padding: 8px 10px;
            border-radius: 5px;
            border: 1px solid #ddd;
            margin-left: 8px;
        }
        
        .dataTables_wrapper .dataTables_info,
        .dataTables_wrapper .dataTables_paginate {
            margin-top: 15px;
        }
        
        .dataTables_wrapper .dataTables_paginate .paginate_button {
            padding: 5px 12px;
            border-radius: 5px;
            margin: 0 3px;
        }
        
        .dataTables_wrapper .dataTables_paginate .paginate_button.current {
            background: linear-gradient(90deg, #2196F3, #1976D2);
            color: white !important;
            border: none;
        }
        
        .dataTables_wrapper .dataTables_paginate .paginate_button:hover {
            background: #e0e4ec;
            color: #333 !important;
            border: 1px solid transparent;
        }
        
        /* Table row styling */
        .table-success {
            background-color: rgba(40, 167, 69, 0.1) !important;
        }
        
        .table-danger {
            background-color: rgba(220, 53, 69, 0.1) !important;
        }
        
        table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            margin-bottom: 20px;
            background-color: white;
        }
        
        th, td {
            padding: 15px 18px;
            text-align: left;
        }
        
        th {
            background: linear-gradient(90deg, #2196F3, #1976D2);
            color: white;
            font-weight: 600;
            position: sticky;
            top: 0;
            z-index: 10;
        }
        
        th:first-child {
            border-top-left-radius: 8px;
        }
        
        th:last-child {
            border-top-right-radius: 8px;
        }
        
        tr:last-child td:first-child {
            border-bottom-left-radius: 8px;
        }
        
        tr:last-child td:last-child {
            border-bottom-right-radius: 8px;
        }
        
        tbody tr {
            border-bottom: 1px solid rgba(0,0,0,0.05);
            transition: all 0.2s;
        }
        
        tr:hover {
            background-color: #f8f9ff;
            transform: scale(1.01);
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
        }
        
        .high {
            color: #28a745;
            font-weight: 600;
        }
        
        .medium {
            color: #ffc107;
            font-weight: 600;
        }
        
        .low {
            color: #dc3545;
            font-weight: 600;
        }
        
        .filters {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-bottom: 25px;
            background-color: #f8f9ff;
            padding: 20px;
            border-radius: 10px;
            box-shadow: inset 0 0 5px rgba(0,0,0,0.05);
        }
        
        .filter-group {
            flex: 1;
            min-width: 220px;
            padding: 10px;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        
        .filter-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #333;
        }
        
        .filter-group select, .filter-group input {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background-color: white;
            font-size: 14px;
        }
        
        .action-btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #2196F3, #1976D2);
            color: white;
            padding: 12px 24px;
            text-decoration: none;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 15px;
            font-weight: 500;
            transition: all 0.3s;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        
        .action-btn:hover {
            background: linear-gradient(135deg, #1976D2, #0D47A1);
            transform: translateY(-3px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.15);
        }
        
        .export-btn {
            background: linear-gradient(135deg, #28a745, #20883a);
        }
        
        .export-btn:hover {
            background: linear-gradient(135deg, #218838, #1d7232);
        }
        
        .back-btn {
            background: linear-gradient(135deg, #6c757d, #5a6268);
        }
        
        .back-btn:hover {
            background: linear-gradient(135deg, #5a6268, #4e555b);
        }
        
        .footer {
            text-align: center;
            margin-top: 50px;
            padding: 20px 0;
            background: linear-gradient(90deg, #2196F3, #1976D2);
            color: white;
            border-radius: 10px;
            box-shadow: 0 -5px 15px rgba(0,0,0,0.1);
        }
        
        .footer p {
            margin: 0;
            font-size: 0.95rem;
            opacity: 0.9;
        }
        
        /* Visual indicators */
        .badge {
            display: inline-block;
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            text-align: center;
        }
        
        .badge-success {
            background-color: rgba(40, 167, 69, 0.2);
            color: #28a745;
        }
        
        .badge-warning {
            background-color: rgba(255, 193, 7, 0.2);
            color: #ffc107;
        }
        
        .badge-danger {
            background-color: rgba(220, 53, 69, 0.2);
            color: #dc3545;
        }
        
        /* Data visualization enhancements */
        .chart-card {
            position: relative;
            overflow: hidden;
            border-radius: 15px;
            background: white;
        }
        
        .chart-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 7px;
            background: linear-gradient(90deg, #2196F3, #1976D2, #0D47A1);
        }
        
        /* Loader animation */
        .loader {
            display: inline-block;
            width: 30px;
            height: 30px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* Responsive adjustments */
        @media (max-width: 768px) {
            .dashboard {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        
        @media (max-width: 576px) {
            .dashboard {
                grid-template-columns: 1fr;
            }
            
            .card-header {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .card-header .action-btn {
                margin-top: 10px;
            }
        }
        
        .attendance-rate {
            font-weight: bold;
        }
        
        .attendance-85-plus {
            color: #28a745;
        }
        
        .attendance-75-85 {
            color: #ffc107;
        }
        
        .attendance-below-75 {
            color: #dc3545;
        }
        
        .tab-container {
            margin-bottom: 30px;
        }
        
        .tabs {
            display: flex;
            overflow-x: auto;
            padding-bottom: 5px;
            margin-bottom: 20px;
            border-bottom: none;
        }
        
        .tab {
            padding: 12px 25px;
            cursor: pointer;
            margin-right: 10px;
            border-radius: 10px;
            font-weight: 500;
            color: #666;
            background-color: #f0f2f5;
            transition: all 0.3s;
            white-space: nowrap;
            border: none;
        }
        
        .tab:hover {
            background-color: #e0e4ec;
            color: #333;
        }
        
        .tab.active {
            background: linear-gradient(90deg, #2196F3, #1976D2);
            color: white;
            font-weight: 600;
            box-shadow: 0 4px 10px rgba(33, 150, 243, 0.3);
            transform: translateY(-3px);
        }
        
        .tab-content {
            display: none;
            padding: 0;
            animation: fadeIn 0.5s;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .tab-content.active {
            display: block;
        }
        
        .status-select {
            padding: 8px 10px;
            border-radius: 5px;
            border: 1px solid #ddd;
            background-color: white;
            font-size: 14px;
            width: 100%;
            transition: border-color 0.3s;
        }
        
        .status-select:focus {
            border-color: #2196F3;
            outline: none;
            box-shadow: 0 0 0 2px rgba(33, 150, 243, 0.25);
        }
        
        .form-select {
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' fill='%23333' viewBox='0 0 16 16'%3E%3Cpath d='M7.247 11.14 2.451 5.658C1.885 5.013 2.345 4 3.204 4h9.592a1 1 0 0 1 .753 1.659l-4.796 5.48a1 1 0 0 1-1.506 0z'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 0.75rem center;
            background-size: 12px 12px;
            padding-right: 2rem;
        }
        
        .form-control {
            padding: 8px 12px;
            border-radius: 5px;
            border: 1px solid #ddd;
            background-color: white;
            font-size: 14px;
            width: 100%;
            transition: border-color 0.3s;
        }
        
        .form-control:focus {
            border-color: #2196F3;
            outline: none;
            box-shadow: 0 0 0 2px rgba(33, 150, 243, 0.25);
        }
        
        .date-range-container {
            position: relative;
        }
        
        .date-icon {
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            color: #777;
            pointer-events: none;
        }
        
        .time-badge {
            display: inline-flex;
            align-items: center;
            background-color: rgba(33, 150, 243, 0.1);
            color: #2196F3;
            padding: 4px 8px;
            border-radius: 20px;
            font-size: 13px;
            font-weight: 500;
        }
        
        .text-center {
            text-align: center;
        }
        
        .me-1 {
            margin-right: 4px;
        }
        
        .save-btn {
            background: linear-gradient(135deg, #4CAF50, #388E3C);
            padding: 6px 12px;
            font-size: 13px;
            border-radius: 5px;
        }
        
        .save-btn:hover {
            background: linear-gradient(135deg, #388E3C, #2E7D32);
        }
        
        .action-btns-wrapper {
            display: flex;
            justify-content: center;
            gap: 5px;
        }
        
        /* Badge styles for status */
        .status-badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            text-align: center;
        }
        
        .status-present {
            background-color: rgba(40, 167, 69, 0.2);
            color: #28a745;
        }
        
        .status-absent {
            background-color: rgba(220, 53, 69, 0.2);
            color: #dc3545;
        }
        
        /* Animation for status badges */
        @keyframes pulse-green {
            0% { box-shadow: 0 0 0 0 rgba(40, 167, 69, 0.4); }
            70% { box-shadow: 0 0 0 6px rgba(40, 167, 69, 0); }
            100% { box-shadow: 0 0 0 0 rgba(40, 167, 69, 0); }
        }
        
        @keyframes pulse-red {
            0% { box-shadow: 0 0 0 0 rgba(220, 53, 69, 0.4); }
            70% { box-shadow: 0 0 0 6px rgba(220, 53, 69, 0); }
            100% { box-shadow: 0 0 0 0 rgba(220, 53, 69, 0); }
        }
        
        .status-present {
            animation: pulse-green 2s infinite;
        }
        
        .status-absent {
            animation: pulse-red 2s infinite;
        }
        
        /* Common styles */
        .attendance-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .card {
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
            overflow: hidden;
        }
        
        .card-header {
            background-color: #f8f9fa;
            border-bottom: 1px solid #e3e6f0;
            padding: 15px 20px;
        }
        
        .card-body {
            padding: 20px;
        }
        
        /* Table styles */
        .attendance-table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .attendance-table th {
            background-color: #f8f9fa;
            font-weight: 600;
            text-align: left;
            padding: 12px 15px;
            border-bottom: 2px solid #e3e6f0;
        }
        
        .attendance-table td {
            padding: 12px 15px;
            border-bottom: 1px solid #e3e6f0;
            vertical-align: middle;
        }
        
        .attendance-table tr:hover {
            background-color: #f8f9fa;
        }
        
        /* Status badges */
        .status-present {
            background-color: #28a745;
            color: white;
            padding: 5px 10px;
            border-radius: 20px;
            display: inline-block;
            animation: pulse-green 2s infinite;
        }
        
        .status-absent {
            background-color: #dc3545;
            color: white;
            padding: 5px 10px;
            border-radius: 20px;
            display: inline-block;
            animation: pulse-red 2s infinite;
        }
        
        @keyframes pulse-green {
            0% {
                box-shadow: 0 0 0 0 rgba(40, 167, 69, 0.4);
            }
            70% {
                box-shadow: 0 0 0 10px rgba(40, 167, 69, 0);
            }
            100% {
                box-shadow: 0 0 0 0 rgba(40, 167, 69, 0);
            }
        }
        
        @keyframes pulse-red {
            0% {
                box-shadow: 0 0 0 0 rgba(220, 53, 69, 0.4);
            }
            70% {
                box-shadow: 0 0 0 10px rgba(220, 53, 69, 0);
            }
            100% {
                box-shadow: 0 0 0 0 rgba(220, 53, 69, 0);
            }
        }
        
        /* Button styles */
        .btn {
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .btn-primary {
            background-color: #4e73df;
            border-color: #4e73df;
            color: white;
        }
        
        .btn-primary:hover {
            background-color: #2e59d9;
            border-color: #2653d4;
        }
        
        .btn-danger {
            background-color: #e74a3b;
            border-color: #e74a3b;
            color: white;
        }
        
        .btn-danger:hover {
            background-color: #be2617;
            border-color: #be2617;
        }
        
        /* Filter styles */
        .filters {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 20px;
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
        }
        
        .filter-group {
            flex: 1;
            min-width: 200px;
            padding: 10px;
        }
        
        .filter-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
        }
        
        .filter-group select,
        .filter-group input {
            width: 100%;
            padding: 8px;
            border: 1px solid #ced4da;
            border-radius: 5px;
            background-color: white;
        }
        
        #apply-filters {
            background-color: #4e73df;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
            align-self: flex-end;
            margin-top: 22px;
        }
        
        #apply-filters:hover {
            background-color: #2e59d9;
        }
        
        /* Action buttons wrapper */
        .action-btns-wrapper {
            display: flex;
            gap: 5px;
            justify-content: center;
        }
        
        /* Filter card */
        .filter-card {
            background-color: white;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        
        /* Responsive adjustments */
        @media (max-width: 768px) {
            .filter-group {
                min-width: 100%;
            }
            
            .filters {
                flex-direction: column;
            }
            
            #apply-filters {
                width: 100%;
                margin-top: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="navbar">
        <h1>Student Attendance Management System</h1>
    </div>
    
    <!-- Loading overlay -->
    <div id="loading-overlay" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(33, 150, 243, 0.7); display: flex; justify-content: center; align-items: center; z-index: 9999;">
        <div style="text-align: center; color: white;">
            <div class="loader"></div>
            <p style="margin-top: 10px; font-weight: 500;">Loading Analytics...</p>
        </div>
    </div>
    
    <div class="container">
        {% if message %}
        <div class="card">
            <p class="message">{{ message }}</p>
        </div>
        {% else %}
        
        <!-- Date Display -->
        <div class="card" style="text-align: center; margin-bottom: 25px;">
            <h2 id="current-date" style="margin-bottom: 5px;">Today's Date</h2>
            <p id="current-time" style="font-size: 1.1rem; color: #666;">Current Time</p>
        </div>
        
        <!-- Dashboard Stats -->
        <div class="dashboard">
            <div class="stat-card">
                <h3>Total Students</h3>
                <p>{{ analytics.total_students if analytics and analytics.total_students else 0 }}</p>
            </div>
            <div class="stat-card">
                <h3>Total Days</h3>
                <p>{{ analytics.total_days if analytics and analytics.total_days else 0 }}</p>
            </div>
            <div class="stat-card">
                <h3>Average Attendance</h3>
                <p>
                    {% if analytics and analytics.student_analytics %}
                        {% set total_rate = 0 %}
                        {% for student, data in analytics.student_analytics.items() %}
                            {% set total_rate = total_rate + data.attendance_rate %}
                        {% endfor %}
                        {{ (total_rate / analytics.total_students)|round(2) }}%
                    {% else %}
                        0%
                    {% endif %}
                </p>
            </div>
            <div class="stat-card">
                <h3>Present Today</h3>
                <p>
                    {% if analytics and analytics.day_analytics %}
                        {% set today = analytics.dates[-1] if analytics.dates else '' %}
                        {% if today in analytics.day_analytics %}
                            {{ analytics.day_analytics[today].present_students }}
                        {% else %}
                            0
                        {% endif %}
                    {% else %}
                        0
                    {% endif %}
                </p>
            </div>
        </div>
        
        <!-- Tab Navigation -->
        <div class="tab-container">
            <div class="tabs">
                <div class="tab active" data-tab="attendance-records">Attendance Records</div>
                <div class="tab" data-tab="student-analytics">Student Analytics</div>
                <div class="tab" data-tab="daily-analytics">Daily Analytics</div>
                <div class="tab" data-tab="visualizations">Visualizations</div>
            </div>
            
            <!-- Attendance Records Tab -->
            <div id="attendance-records" class="tab-content active">
                <div class="card">
                    <div class="card-header">
                        <h2>Attendance Records</h2>
                        <div class="d-flex justify-content-end mb-3">
                            <button id="export-csv" class="btn btn-success me-2">
                                <i class="fas fa-file-csv me-1"></i> Export to CSV
                            </button>
                            <button id="export-excel" class="btn btn-primary">
                                <i class="fas fa-file-excel me-1"></i> Export to Excel
                            </button>
                        </div>
                    </div>
                    
                    <div class="filters">
                        <div class="filter-group">
                            <label for="student-filter"><i class="fas fa-user me-1"></i> Student</label>
                            <select id="student-filter" class="form-select">
                                <option value="">All Students</option>
                                {% if analytics and analytics.students %}
                                    {% for student in analytics.students %}
                                        <option value="{{ student }}">{{ student }}</option>
                                    {% endfor %}
                                {% endif %}
                            </select>
                        </div>
                        <div class="filter-group">
                            <label for="date-range"><i class="fas fa-calendar-alt me-1"></i> Date Range</label>
                            <div class="date-range-container">
                                <input type="text" id="date-range" class="form-control" placeholder="Select date range">
                                <i class="fas fa-calendar date-icon"></i>
                            </div>
                        </div>
                        <div class="filter-group">
                            <label for="status-filter"><i class="fas fa-check-circle me-1"></i> Status</label>
                            <select id="status-filter" class="form-select">
                                <option value="">All Status</option>
                                <option value="Present">Present</option>
                                <option value="Absent">Absent</option>
                            </select>
                        </div>
                        <div class="filter-group" style="display: flex; align-items: flex-end;">
                            <button id="apply-filters" class="action-btn" style="width: 100%; margin-top: 0px;">
                                <i class="fas fa-filter me-1"></i> Apply Filters
                            </button>
                        </div>
                    </div>
                    
                    <div class="table-container">
                        <table id="attendance-table" class="display">
                            <thead>
                                <tr>
                                    <th>Name</th>
                                    <th>Date</th>
                                    <th>Day</th>
                                    <th>Time</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% if attendance_records %}
                                    {% for record in attendance_records %}
                                    <tr data-name="{{ record[0] }}" data-date="{{ record[1] }}">
                                        <td><strong>{{ record[0] }}</strong></td>
                                        <td>{{ record[1] }}</td>
                                        <td>{{ record[2] }}</td>
                                        <td><span class="time-badge"><i class="fas fa-clock me-1"></i>{{ record[3] }}</span></td>
                                        <td>
                                            <select class="status-select form-control">
                                                <option value="Present" {% if record[4] == "Present" %}selected{% endif %}>Present</option>
                                                <option value="Absent" {% if record[4] == "Absent" %}selected{% endif %}>Absent</option>
                                            </select>
                                        </td>
                                        <td>
                                            <div class="action-btns-wrapper">
                                                <button class="save-btn action-btn">
                                                    <i class="fas fa-save me-1"></i> Save
                                                </button>
                                            </div>
                                        </td>
                                    </tr>
                                    {% endfor %}
                                {% else %}
                                    <tr>
                                        <td colspan="6" class="text-center">No attendance records found</td>
                                    </tr>
                                {% endif %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            
            <!-- Student Analytics Tab -->
            <div id="student-analytics" class="tab-content">
                <div class="card">
                    <div class="card-header">
                        <h2>Student Attendance Analytics</h2>
                    </div>
                    
                    <div class="table-container">
                        <table id="student-table" class="display">
                            <thead>
                                <tr>
                                    <th>Student Name</th>
                                    <th>Total Days</th>
                                    <th>Days Present</th>
                                    <th>Attendance Rate</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% if analytics and analytics.student_analytics %}
                                    {% for student, data in analytics.student_analytics.items() %}
                                    <tr>
                                        <td>{{ student }}</td>
                                        <td>{{ data.total_days }}</td>
                                        <td>{{ data.present_days }}</td>
                                        <td class="
                                            attendance-rate
                                            {% if data.attendance_rate >= 85 %}attendance-85-plus
                                            {% elif data.attendance_rate >= 75 %}attendance-75-85
                                            {% else %}attendance-below-75{% endif %}
                                        ">
                                            {{ data.attendance_rate }}%
                                        </td>
                                        <td>
                                            {% if data.attendance_rate >= 85 %}
                                                <span class="badge badge-success">Good</span>
                                            {% elif data.attendance_rate >= 75 %}
                                                <span class="badge badge-warning">Average</span>
                                            {% else %}
                                                <span class="badge badge-danger">Poor</span>
                                            {% endif %}
                                        </td>
                                    </tr>
                                    {% endfor %}
                                {% else %}
                                    <tr>
                                        <td></td><td></td><td></td><td></td><td></td>
                                    </tr>
                                {% endif %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            
            <!-- Daily Analytics Tab -->
            <div id="daily-analytics" class="tab-content">
                <div class="card">
                    <div class="card-header">
                        <h2>Daily Attendance Analysis</h2>
                    </div>
                    
                    <div class="table-container">
                        <table id="daily-table" class="display">
                            <thead>
                                <tr>
                                    <th>Date</th>
                                    <th>Day</th>
                                    <th>Total Students</th>
                                    <th>Present</th>
                                    <th>Absent</th>
                                    <th>Attendance Rate</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% if analytics and analytics.day_analytics %}
                                    {% for date in analytics.dates %}
                                        {% if date in analytics.day_analytics %}
                                            {% set day_data = analytics.day_analytics[date] %}
                                            {% set present = day_data.present_students %}
                                            {% set total = day_data.total_students %}
                                            {% set absent = total - present %}
                                            {% set rate = (present / total * 100) if total > 0 else 0 %}
                                            {% set day = day_data.records[0][2] if day_data.records|length > 0 else '' %}
                                            <tr>
                                                <td>{{ date }}</td>
                                                <td>{{ day }}</td>
                                                <td>{{ total }}</td>
                                                <td>{{ present }}</td>
                                                <td>{{ absent }}</td>
                                                <td class="
                                                    attendance-rate
                                                    {% if rate >= 85 %}attendance-85-plus
                                                    {% elif rate >= 75 %}attendance-75-85
                                                    {% else %}attendance-below-75{% endif %}
                                                ">
                                                    {{ rate|round(2) }}%
                                                </td>
                                            </tr>
                                        {% endif %}
                                    {% endfor %}
                                {% else %}
                                    <tr>
                                        <td></td><td></td><td></td><td></td><td></td><td></td>
                                    </tr>
                                {% endif %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            
            <!-- Visualizations Tab -->
            <div id="visualizations" class="tab-content">
                <div class="card chart-card">
                    <div class="card-header">
                        <h2>Attendance Trends</h2>
                    </div>
                    
                    <div class="chart-container">
                        <canvas id="attendance-trend-chart"></canvas>
                    </div>
                </div>
                
                <div class="card chart-card">
                    <div class="card-header">
                        <h2>Student Attendance Comparison</h2>
                    </div>
                    
                    <div class="chart-container">
                        <canvas id="student-comparison-chart"></canvas>
                    </div>
                </div>
                
                <div class="card chart-card">
                    <div class="card-header">
                        <h2>Weekly Attendance Pattern</h2>
                    </div>
                    
                    <div class="chart-container">
                        <canvas id="weekly-pattern-chart"></canvas>
                    </div>
                </div>
            </div>

        </div>
        {% endif %}
        
        <a href="/" class="action-btn back-btn">Back to Home</a>
    </div>
    
    <div class="footer">
        <p>Student Attendance Management System &copy; 2023</p>
    </div>

    <!-- Add hidden analytics data container after the tabs -->
    <div id="analytics-data" data-analytics='{{ analytics|tojson if analytics else "{}" }}' style="display: none;"></div>

    <script>
        $(document).ready(function() {
            try {
                // Hide loading overlay immediately
                setTimeout(function() {
                    $('#loading-overlay').fadeOut(500);
                }, 800);
                
                // Create DataTables object for attendance table with all options
                var attendanceTable = $('#attendance-table').DataTable({
                    responsive: true,
                    searching: true,
                    paging: true,
                    ordering: true,
                    info: true,
                    lengthChange: true,
                    autoWidth: false,
                    pageLength: 10,
                    dom: 'Bfrtip',
                    buttons: [
                        {
                            extend: 'csv',
                            text: '<i class="fas fa-file-csv"></i> Export CSV',
                            className: 'btn btn-sm btn-outline-primary mb-2',
                            exportOptions: {
                                columns: ':not(:last-child)'
                            }
                        }
                    ],
                    initComplete: function() {
                        try {
                            // Update row colors based on attendance status
                            $('#attendance-table tbody tr').each(function() {
                                var status = $(this).find('.status-select').val();
                                if (status === 'Present') {
                                    $(this).addClass('table-success');
                                } else if (status === 'Absent') {
                                    $(this).addClass('table-danger');
                                }
                            });
                        } catch (e) {
                            console.error("Error updating row colors:", e);
                        }
                    }
                });

                // Function to update date and time display
                function updateDateTime() {
                    try {
                        var now = new Date();
                        var dateOptions = { 
                            weekday: 'long', 
                            year: 'numeric', 
                            month: 'long', 
                            day: 'numeric'
                        };
                        var timeOptions = {
                            hour: '2-digit',
                            minute: '2-digit',
                            second: '2-digit'
                        };
                        
                        $('#current-date').text(now.toLocaleDateString('en-US', dateOptions));
                        $('#current-time').text(now.toLocaleTimeString('en-US', timeOptions));
                    } catch (e) {
                        console.error("Error updating date/time:", e);
                    }
                }

                // Initialize date/time display
                updateDateTime();
                setInterval(updateDateTime, 1000);
                
                // Initialize date range picker
                $('#date-range').daterangepicker({
                    opens: 'right',
                    autoUpdateInput: false,
                    locale: {
                        cancelLabel: 'Clear',
                        format: 'YYYY-MM-DD'
                    }
                });
                
                // Date range picker event handlers
                $('#date-range').on('apply.daterangepicker', function(ev, picker) {
                    $(this).val(picker.startDate.format('YYYY-MM-DD') + ' to ' + picker.endDate.format('YYYY-MM-DD'));
                    filterTable();
                });
                
                $('#date-range').on('cancel.daterangepicker', function() {
                    $(this).val('');
                    filterTable();
                });
                
                // Setup event handlers for student and status filters
                $('#student-filter, #status-filter').on('change', function() {
                    // Auto-filter when selection changes
                    filterTable();
                });
                
                // Setup event handler for apply filters button
                $('#apply-filters').on('click', function() {
                    filterTable();
                });
                
                // Function to filter the table based on selected criteria
                function filterTable() {
                    try {
                        var studentFilter = $('#student-filter').val() || '';
                        var statusFilter = $('#status-filter').val() || '';
                        var dateRangeFilter = $('#date-range').val() || '';
                        
                        console.log("Filtering with - Student:", studentFilter, "Status:", statusFilter, "Date Range:", dateRangeFilter);
                        
                        // Apply filters
                        attendanceTable.draw();
                        
                        // Custom filtering function for DataTables
                        $.fn.dataTable.ext.search.push(function(settings, data, dataIndex) {
                            var row = attendanceTable.row(dataIndex).node();
                            var name = $(row).data('name') || '';
                            var status = $(row).find('.status-select').val() || '';
                            var date = $(row).data('date') || '';
                            
                            // Student filter
                            if (studentFilter && studentFilter !== "All" && name !== studentFilter) {
                                return false;
                            }
                            
                            // Status filter
                            if (statusFilter && statusFilter !== "All" && status !== statusFilter) {
                                return false;
                            }
                            
                            // Date range filter
                            if (dateRangeFilter) {
                                var dates = dateRangeFilter.split(' to ');
                                if (dates.length === 2) {
                                    var startDate = new Date(dates[0]);
                                    var endDate = new Date(dates[1]);
                                    var rowDate = new Date(date);
                                    
                                    if (rowDate < startDate || rowDate > endDate) {
                                        return false;
                                    }
                                }
                            }
                            
                            return true;
                        });
                        
                        // Redraw the table with filters applied
                        attendanceTable.draw();
                        
                        // Remove the custom filter after drawing
                        var filterIndex = $.fn.dataTable.ext.search.indexOf($.fn.dataTable.ext.search[$.fn.dataTable.ext.search.length - 1]);
                        if (filterIndex !== -1) {
                            $.fn.dataTable.ext.search.splice(filterIndex, 1);
                        }
                    } catch (e) {
                        console.error("Error in filter table function:", e);
                    }
                }
                
                // Create DataTables for student analytics
                $('#student-analytics-table').DataTable({
                    responsive: true,
                    paging: true,
                    searching: true,
                    ordering: true,
                    pageLength: 5,
                    dom: 'frtip'
                });
                
                // Create DataTables for daily analytics
                $('#daily-analytics-table').DataTable({
                    responsive: true,
                    paging: true,
                    searching: true,
                    ordering: true,
                    pageLength: 5,
                    dom: 'frtip'
                });
                
                // Global variable declarations for charts
                window.trendChart = null;
                window.comparisonChart = null;
                window.weeklyChart = null;
                
                // Initialize charts
                function initializeCharts() {
                    try {
                        // Check if chart elements exist
                        var trendCtx = document.getElementById('attendance-trend-chart');
                        var comparisonCtx = document.getElementById('student-comparison-chart');
                        var weeklyCtx = document.getElementById('weekly-pattern-chart');
                        
                        if (!trendCtx || !comparisonCtx || !weeklyCtx) {
                            console.log("Chart elements not found, skipping chart initialization");
                            return;
                        }
                        
                        trendCtx = trendCtx.getContext('2d');
                        comparisonCtx = comparisonCtx.getContext('2d');
                        weeklyCtx = weeklyCtx.getContext('2d');
                        
                        // Get analytics data from the HTML data attribute
                        var analyticsDataElem = $('#analytics-data');
                        if (!analyticsDataElem.length) {
                            console.log("Analytics data element not found");
                            return;
                        }
                        
                        var analyticsDataStr = analyticsDataElem.attr('data-analytics');
                        if (!analyticsDataStr) {
                            console.log("No analytics data available");
                            return;
                        }
                        
                        var analyticsData = {};
                        try {
                            analyticsData = JSON.parse(analyticsDataStr);
                        } catch (e) {
                            console.error("Error parsing analytics data:", e);
                            return;
                        }
                        
                        var hasData = analyticsData && Object.keys(analyticsData).length > 0;
                        if (!hasData) {
                            console.log("No analytics data available");
                            return;
                        }
                        
                        console.log("Analytics data loaded:", hasData ? "Yes" : "No");
                        
                        // Create trend data from day_analytics
                        if (analyticsData.day_analytics && Object.keys(analyticsData.day_analytics).length > 0) {
                            var trendData = {};
                            var sortedDates = analyticsData.dates || [];
                            var dates = [];
                            var attendanceRates = [];
                            
                            // Process each date to create trend data
                            for (var i = 0; i < sortedDates.length; i++) {
                                var date = sortedDates[i];
                                if (date && date in analyticsData.day_analytics) {
                                    var dayData = analyticsData.day_analytics[date];
                                    if (dayData) {
                                        var present = dayData.present_students || 0;
                                        var total = dayData.total_students || 1; // Avoid division by zero
                                        var rate = total > 0 ? (present / total * 100).toFixed(2) : 0;
                                        
                                        dates.push(date);
                                        attendanceRates.push(parseFloat(rate));
                                    }
                                }
                            }
                            
                            // Create the trend chart if we have data
                            if (dates.length > 0) {
                                if (window.trendChart) {
                                    window.trendChart.destroy();
                                }
                                
                                window.trendChart = new Chart(trendCtx, {
                                    type: 'line',
                                    data: {
                                        labels: dates,
                                        datasets: [{
                                            label: 'Attendance Rate (%)',
                                            data: attendanceRates,
                                            backgroundColor: 'rgba(78, 115, 223, 0.1)',
                                            borderColor: 'rgba(78, 115, 223, 1)',
                                            pointBackgroundColor: 'rgba(78, 115, 223, 1)',
                                            pointBorderColor: '#fff',
                                            pointHoverRadius: 5,
                                            pointHoverBackgroundColor: 'rgba(78, 115, 223, 1)',
                                            pointHoverBorderColor: 'rgba(78, 115, 223, 1)',
                                            pointHitRadius: 10,
                                            pointBorderWidth: 2,
                                            tension: 0.3
                                        }]
                                    },
                                    options: {
                                        responsive: true,
                                        maintainAspectRatio: false,
                                        scales: {
                                            y: {
                                                beginAtZero: true,
                                                max: 100,
                                                title: {
                                                    display: true,
                                                    text: 'Attendance Rate (%)'
                                                }
                                            },
                                            x: {
                                                title: {
                                                    display: true,
                                                    text: 'Date'
                                                }
                                            }
                                        },
                                        plugins: {
                                            legend: {
                                                display: true,
                                                position: 'top'
                                            },
                                            tooltip: {
                                                enabled: true
                                            }
                                        }
                                    }
                                });
                            }
                        }
                        
                        // Create student comparison chart
                        if (analyticsData.student_analytics && Object.keys(analyticsData.student_analytics).length > 0) {
                            var studentData = analyticsData.student_analytics;
                            var students = [];
                            var presentRates = [];
                            var absentRates = [];
                            
                            for (var student in studentData) {
                                if (studentData.hasOwnProperty(student) && student) {
                                    var data = studentData[student];
                                    if (data) {
                                        students.push(student);
                                        var total = data.total_days || 0;
                                        var present = data.present_days || 0;
                                        var absent = total - present;
                                        
                                        var presentRate = total > 0 ? (present / total * 100).toFixed(2) : 0;
                                        var absentRate = total > 0 ? (absent / total * 100).toFixed(2) : 0;
                                        
                                        presentRates.push(parseFloat(presentRate));
                                        absentRates.push(parseFloat(absentRate));
                                    }
                                }
                            }
                            
                            // Create the student comparison chart if we have data
                            if (students.length > 0) {
                                if (window.comparisonChart) {
                                    window.comparisonChart.destroy();
                                }
                                
                                window.comparisonChart = new Chart(comparisonCtx, {
                                    type: 'bar',
                                    data: {
                                        labels: students,
                                        datasets: [
                                            {
                                                label: 'Present (%)',
                                                data: presentRates,
                                                backgroundColor: 'rgba(40, 167, 69, 0.7)',
                                                borderColor: 'rgba(40, 167, 69, 1)',
                                                borderWidth: 1
                                            },
                                            {
                                                label: 'Absent (%)',
                                                data: absentRates,
                                                backgroundColor: 'rgba(220, 53, 69, 0.7)',
                                                borderColor: 'rgba(220, 53, 69, 1)',
                                                borderWidth: 1
                                            }
                                        ]
                                    },
                                    options: {
                                        responsive: true,
                                        maintainAspectRatio: false,
                                        scales: {
                                            y: {
                                                beginAtZero: true,
                                                max: 100,
                                                title: {
                                                    display: true,
                                                    text: 'Attendance Rate (%)'
                                                }
                                            }
                                        }
                                    }
                                });
                            }
                        }
                        
                        // Create weekly pattern chart
                        if (analyticsData.day_analytics && Object.keys(analyticsData.day_analytics).length > 0) {
                            var dayAnalyticsData = analyticsData.day_analytics;
                            var daysOfWeek = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday', 'Sunday'];
                            var dayAttendance = [0, 0, 0, 0, 0, 0, 0];
                            var dayCount = [0, 0, 0, 0, 0, 0, 0];
                            
                            for (var date in dayAnalyticsData) {
                                if (dayAnalyticsData.hasOwnProperty(date) && date) {
                                    var dayData = dayAnalyticsData[date];
                                    if (dayData && dayData.records && dayData.records.length > 0) {
                                        var dayRecord = dayData.records[0]; // Get the first record for this day
                                        if (dayRecord && dayRecord.length > 2) {
                                            var day = dayRecord[2]; // Get day name
                                            if (day) {
                                                var dayIndex = daysOfWeek.indexOf(day);
                                                if (dayIndex >= 0) {
                                                    dayAttendance[dayIndex] += dayData.present_students || 0;
                                                    dayCount[dayIndex] += 1;
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                            
                            var avgDayAttendance = [];
                            for (var i = 0; i < dayAttendance.length; i++) {
                                avgDayAttendance.push(dayCount[i] ? parseFloat((dayAttendance[i] / dayCount[i]).toFixed(2)) : 0);
                            }
                            
                            // Create weekly pattern chart if we have data
                            if (avgDayAttendance.some(function(val) { return val > 0; })) {
                                if (window.weeklyChart) {
                                    window.weeklyChart.destroy();
                                }
                                
                                window.weeklyChart = new Chart(weeklyCtx, {
                                    type: 'radar',
                                    data: {
                                        labels: daysOfWeek,
                                        datasets: [{
                                            label: 'Average Attendance',
                                            data: avgDayAttendance,
                                            backgroundColor: 'rgba(33, 150, 243, 0.3)',
                                            borderColor: 'rgba(33, 150, 243, 0.8)',
                                            borderWidth: 3
                                        }]
                                    },
                                    options: {
                                        responsive: true,
                                        maintainAspectRatio: false,
                                        scale: {
                                            ticks: {
                                                beginAtZero: true,
                                                max: Math.max.apply(null, avgDayAttendance.filter(function(n) { return !isNaN(n); })) + 1 || 10
                                            }
                                        }
                                    }
                                });
                            }
                        }
                    } catch (e) {
                        console.error("Error initializing charts:", e);
                        console.error("Error details:", e.message);
                        console.error("Error stack:", e.stack);
                    }
                }
                
                // Tab switching
                $('.tab').on('click', function() {
                    try {
                        // Remove active class from all tabs and content
                        $('.tab').removeClass('active');
                        $('.tab-content').removeClass('active');
                        
                        // Add active class to clicked tab and corresponding content
                        $(this).addClass('active');
                        const tabId = $(this).data('tab');
                        $('#' + tabId).addClass('active');
                        
                        // Initialize charts if visualizations tab is selected
                        if (tabId === 'visualizations') {
                            setTimeout(initializeCharts, 100);
                        }
                    } catch (e) {
                        console.error("Error in tab switching:", e);
                    }
                });

                // Initialize charts when page loads
                setTimeout(initializeCharts, 500);
                
                // Handle saving attendance status changes
                $('.save-btn').click(function() {
                    try {
                        const row = $(this).closest('tr');
                        const name = row.data('name');
                        const date = row.data('date');
                        const status = row.find('.status-select').val();
                        
                        if (!name || !date || !status) {
                            console.error("Missing data for save operation");
                            Swal.fire({
                                icon: 'error',
                                title: 'Error',
                                text: 'Missing required data (name, date, or status)'
                            });
                            return;
                        }
                        
                        // Save button animation
                        const saveBtn = $(this);
                        saveBtn.html('<i class="fas fa-spinner fa-spin"></i> Saving...');
                        saveBtn.prop('disabled', true);
                        
                        // Send data to server
                        $.ajax({
                            url: '/update-attendance',
                            type: 'POST',
                            contentType: 'application/json',
                            data: JSON.stringify({
                                name: name,
                                date: date,
                                status: status
                            }),
                            success: function(response) {
                                // Update UI with success message
                                Swal.fire({
                                    icon: 'success',
                                    title: 'Success',
                                    text: response.message,
                                    timer: 2000,
                                    showConfirmButton: false
                                });
                                
                                // Update row styling based on status
                                row.removeClass('table-success table-danger');
                                if (status === 'Present') {
                                    row.addClass('table-success');
                                } else if (status === 'Absent') {
                                    row.addClass('table-danger');
                                }
                                
                                // Reset save button
                                saveBtn.html('<i class="fas fa-save me-1"></i> Save');
                                saveBtn.prop('disabled', false);
                            },
                            error: function(xhr) {
                                // Show error message
                                let errorMsg = 'Failed to update attendance';
                                if (xhr.responseJSON && xhr.responseJSON.message) {
                                    errorMsg = xhr.responseJSON.message;
                                }
                                
                                Swal.fire({
                                    icon: 'error',
                                    title: 'Error',
                                    text: errorMsg
                                });
                                
                                // Reset save button
                                saveBtn.html('<i class="fas fa-save me-1"></i> Save');
                                saveBtn.prop('disabled', false);
                            }
                        });
                    } catch (e) {
                        console.error("Error in save button handler:", e);
                    }
                });
                
                // Handle deleting attendance records
                $('.delete-btn').click(function() {
                    try {
                        const row = $(this).closest('tr');
                        const name = row.data('name');
                        const date = row.data('date');
                        
                        if (!name || !date) {
                            console.error("Missing data for delete operation");
                            Swal.fire({
                                icon: 'error',
                                title: 'Error',
                                text: 'Missing required data (name or date)'
                            });
                            return;
                        }
                        
                        // Confirm deletion
                        Swal.fire({
                            title: 'Delete Record?',
                            text: `Are you sure you want to delete the attendance record for ${name} on ${date}?`,
                            icon: 'warning',
                            showCancelButton: true,
                            confirmButtonColor: '#dc3545',
                            cancelButtonColor: '#6c757d',
                            confirmButtonText: 'Yes, delete it!'
                        }).then((result) => {
                            if (result.isConfirmed) {
                                // Send delete request to server
                                $.ajax({
                                    url: '/delete-attendance',
                                    type: 'POST',
                                    contentType: 'application/json',
                                    data: JSON.stringify({
                                        name: name,
                                        date: date
                                    }),
                                    success: function(response) {
                                        // Show success message
                                        Swal.fire({
                                            icon: 'success',
                                            title: 'Deleted!',
                                            text: response.message,
                                            timer: 2000,
                                            showConfirmButton: false
                                        });
                                        
                                        // Remove row from table
                                        attendanceTable.row(row).remove().draw();
                                    },
                                    error: function(xhr) {
                                        // Show error message
                                        let errorMsg = 'Failed to delete attendance record';
                                        if (xhr.responseJSON && xhr.responseJSON.message) {
                                            errorMsg = xhr.responseJSON.message;
                                        }
                                        
                                        Swal.fire({
                                            icon: 'error',
                                            title: 'Error',
                                            text: errorMsg
                                        });
                                    }
                                });
                            }
                        });
                    } catch (e) {
                        console.error("Error in delete button handler:", e);
                    }
                });
                
                // Export to Excel function
                $('#export-excel').on('click', function() {
                    try {
                        window.location.href = '/download-excel';
                    } catch (e) {
                        console.error("Error in export excel handler:", e);
                    }
                });
                
            } catch (e) {
                console.error("Error in document ready:", e);
                alert("An error occurred while initializing the page. Please check the console for details.");
            }
        });
    </script>
</body>
</html>
